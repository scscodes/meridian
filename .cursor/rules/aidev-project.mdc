---
description: AIDev extension project conventions and architecture
alwaysApply: true
---

# AIDev Project Rules

Read `docs/SPEC.md` for the full project specification. It is the single source of truth.

## Architecture

- **Monorepo**: `packages/core` (pure TS, no IDE deps) + `packages/vscode` (extension shell)
- Core logic MUST NOT import from `vscode` or any IDE API
- Shared types live in `@aidev/core` — never duplicate in the vscode package

## Key Locations

- **All types**: `packages/core/src/types/` — the only place to define shared interfaces
- **All defaults**: `packages/core/src/settings/defaults.ts` — single file, no magic numbers anywhere else
- **All tool metadata**: `packages/core/src/tools/index.ts` → `TOOL_REGISTRY` — commands, names, descriptions derive from here
- **Settings validation**: `packages/core/src/settings/schema.ts`
- **Mode → tier mapping**: `packages/core/src/settings/schema.ts` → `MODE_TIER_MAP`

## Constraints

- No magic numbers. Use named constants. ESLint enforces this.
- No `any`. TypeScript strict mode is on.
- Use `.js` extensions in all import paths (Node16 resolution).
- All destructive actions (comment pruning, commits) must propose for user approval — never auto-apply.
- Tool commands use `aidev.` prefix. Settings use `aidev.*` namespace.

## Adding a New Tool

1. Add `ToolId` variant in `packages/core/src/types/analysis.ts`
2. Add entry to `TOOL_REGISTRY` in `packages/core/src/tools/index.ts`
3. Create tool class implementing `ITool` in `packages/core/src/tools/<name>/index.ts`
4. The chat command, sidebar entry, and VSCode command are automatically derived from the registry entry
